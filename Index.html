<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Escanear Productos y Mostrar Detalles</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f9f9f9;
        }
        h1, h2 {
            color: #333;
        }
        #scan-button {
            padding: 10px 20px;
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        #scan-button:hover {
            background-color: #0056b3;
        }
        #result {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #fff;
        }
        #scanner {
            width: 100%;
            height: 400px;
            border: 1px solid #ccc;
            margin-top: 20px;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <h1>Escanear Producto y Mostrar Detalles</h1>
    <button id="scan-button">Escanear Código de Barras</button>
    <div id="scanner" class="hidden"></div>
    <div id="result">
        <p>El producto escaneado aparecerá aquí.</p>
    </div>

    <!-- Integración del lector de código de barras -->
    <script src="https://unpkg.com/@zxing/library@latest"></script>
    <script>
        let selectedDeviceId;
        const codeReader = new ZXing.BrowserBarcodeReader();

        document.getElementById('scan-button').addEventListener('click', () => {
            const scannerDiv = document.getElementById('scanner');
            scannerDiv.classList.toggle('hidden');
            
            if (!scannerDiv.classList.contains('hidden')) {
                codeReader.getVideoInputDevices().then((videoInputDevices) => {
                    if (videoInputDevices.length > 0) {
                        selectedDeviceId = videoInputDevices[0].deviceId;
                        codeReader.decodeOnceFromVideoDevice(selectedDeviceId, 'scanner')
                            .then((result) => {
                                console.log(result);
                                buscarProducto(result.text);
                            })
                            .catch((err) => {
                                console.error(err);
                                document.getElementById('result').innerText = 'Error al escanear: ' + err;
                            });
                    } else {
                        console.error('No video input devices found');
                    }
                }).catch((err) => {
                    console.error(err);
                });
            } else {
                codeReader.reset();
            }
        });

        async function fetchProductData() {
            const response = await fetch('productos.json');
            const data = await response.json();
            return data;
        }

        async function buscarProducto(codigo) {
            const productos = await fetchProductData();
            const producto = productos.find(item => item.codigo === codigo);
            mostrarProducto(producto);
        }

        function mostrarProducto(producto) {
            const resultDiv = document.getElementById('result');
            if (producto) {
                resultDiv.innerHTML = `
                    <h2>Detalles del Producto</h2>
                    <p><strong>Código:</strong> ${producto.codigo}</p>
                    <p><strong>Nombre:</strong> ${producto.nombre}</p>
                    <p><strong>Precio:</strong> $${producto.precio}</p>
                    <p><strong>Descripción:</strong> ${producto.descripcion}</p>
                `;
            } else {
                resultDiv.innerHTML = '<p>Producto no encontrado.</p>';
            }
        }
    </script>
</body>
</html>
